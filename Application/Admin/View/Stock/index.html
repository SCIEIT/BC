<extend name="./Application/Admin/View/base.html"/>
<block name="body">
  <h2 class="center-align">股票</h2>
  <div class="container" id="escaped">
  <form class="container" action="<?=U('stock/update')?>" enctype="multipart/form-data" method="post">
      <ul class="collapsible popout" data-collapsible="accordion">
        <?php
        $timearr= array("00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00");
         foreach ($stocks as $stock) { ?>
          <li>
            <div class="collapsible-header">{$stock.stock_name}<i class="fa fa-line-chart"></i>
            <a class="right" href="<?=U("stock/delete",['id'=>$stock['stock_id']])?>"><i class="fa fa-trash-o"></i></a>
            </div>
            <div class="collapsible-body">
              <div class="container input-field">
                <input id="name{$stock.stock_id}" name="{$stock.stock_id}[name]" type="text" class="validate" value="{$stock.stock_name}">
                <label for="name{$stock.stock_id}">股票名称</label>
              </div>
              <div class="container input-field">
                <textarea name="{$stock.stock_id}[bg]" id="discription{$stock.stock_id}" class="materialize-textarea">{$stock.stock_bg}</textarea>
                <label for="discription{$stock.stock_id}">股票简介</label>
              </div>
              <div class="container">
                <ul class="collapsible" data-collapsible="accordion">
                <?php foreach ($stock['trend'] as $key => $year){?>
                  <li>
                      <div class="collapsible-header"><?=date("Y年m月d日  H:i",$year['time'])?>
                        <a class="right" href="<?=U("stock/delete",['id'=>$stock['stock_id'],'time'=>$year['time']])?>"><i class="fa fa-trash-o"></i></a>
                      </div>
                      <div class="collapsible-body">
                          <div class="container">
                            <input type="date" name="<?=$stock['stock_id']?>[trend][<?=$key?>][date]" value="<?=date("Y-m-d",$year['time'])?>" class="datepicker">
                            <div class="container input-field">
                                <select name="<?=$stock['stock_id']?>[trend][<?=$key?>][time]">
                                  <?php foreach ($timearr as $time) { ?>
                                    <option value="<?=$time?>" <?=$time==date('H:i',$year['time'])?"selected":'' ?> ><?=$time?></option>
                                  <?php } ?>
                                </select>
                                <label>选择时间</label>
                            </div>
                            <div class="input-field">
                              <i class="fa fa-rmb prefix amber-text lighten-1"></i>
                              <input id="price{$year.time}" type="text" name="<?=$stock['stock_id']?>[trend][<?=$key?>][price]" value="<?=$year['price']?>" class="validate">
                              <label for="price{$year.time}">价格</label>
                            </div>
                            <div class="input-field">
                              <textarea id="news{$year.time}" name="<?=$stock['stock_id']?>[trend][<?=$key?>][news]" class="materialize-textarea">{$year.news}</textarea>
                              <label for="news{$year.time}">新闻</label>
                            </div>
                          </div>
                      </div>
                    </li>
                    <?php } ?>
                  </ul>
                  <a class="btn waves-effect waves-light blue accent-3" href="<?=U("stock/add",['id'=>$stock['stock_id']])?>">添加事件
                    <i class="fa fa-plus right"></i>
                  </a>
                  <br/>
                  <br/>
              </div>
            </div>
          </li>
          <?php } ?>
      </ul>
      <div class="container">
        <a class="waves-effect waves-light btn <?=$page=='1'?"disabled":""?>" href="<?=U('stock/index',['page'=>$page-1])?>" >上一页</a>
        <a class="waves-effect waves-light btn <?=$pageMax?"disabled":""?>" href="<?=U('stock/index',['page'=>$page+1])?>">下一页</a>
        <a class="btn waves-effect waves-light light-green darken-2" href="<?=U("stock/add")?>">添加股票
          <i class="fa fa-plus right"></i>
        </a>
        <button class="btn waves-effect waves-light red accent-3" type="submit">保存
          <i class="fa fa-save right"></i>
        </button>
      </div>
    </form>
    <br/>
  </div>
</block>
<block name="customJS">
  <script>
    $('.datepicker').pickadate({
        selectMonths: true, // Creates a dropdown to control month
        selectYears: 15 // Creates a dropdown of 15 years to control year
      });
    $(document).ready(function() {
        $('select').material_select();
      });
                
  </script>
</block>